## BUGS
- statusmessage state is being used to display errors (player join view tsx)
- if player is disconnected in the result page, disconnected icon does not show in leaderboard
- dont allow the same avatar to be picked by multiple players
- i am able to join a room that doesnt exist
- player gets diconnected on screen close
- long username limit/truncation
- play again is starting a new game
- if all players have disconnecting, game should end
- Trailing dots may go to the next line on smaller screens
- result screen
    - player: remove leaderboard or fix the cropping
    - host: make the leaderboard more compact. its scrolling too much cant see progress bar
- if you refresh a game, it gets stuck on a screen that says "setting up game room..." unless you do a hard reload
- if x players start the game but one drops off and the remianing players submit their answers, question round should end
- should be able to rejoin a current game

IF There is a big issue with the height, add back the min-h-screen class to the relevant divs in host-game-layout.tsx


## ENHANCEMENTS
- place a toast msg on the player view when reconnecting
- when restarting a game, take back to qr lobby with the same room code
- rebus and trivia should have diff rooms
- Handle room lifecycle events better
    - if host disconnects, end the game for everyone
    - if a user disconnects, show a message to the host (maybe pause the game?)


## FEATURES
- connect to rebus db 
- repick an avatar
- player extra time request (later)
    - add an option to request for an extra 15 seconds on the player view
    - if everyone requests it, add 15 seconds to the timer. 
    - show a small counter of how many people have requested extra time on the host view.
- sound effects
    - ticking sound during last 5 seconds
    - sound when time is up
    - sound when answer is submitted
- host needs an account
    - to purchase packs later on
- Skeleton
    - Use Shadcn UI's Skeleton component to show loading states
    - Show loading sign on the main screen before launching the game

## Code improvements
- Add types all across the app
- Custom components for buttons, modals, etc. to avoid code duplication
- reate a refactor expert agent and use. it every so often
- Remove console logs from server.ts and other files

## Larger ideas
- Users should be able to create their own trivia questions and submit it to a database. We should then be able to review and add it to the game packs.
- They should get rewarded with some in-app currency for every approved submission.
- Let players emote during the game
    - thumbs up, clap, laugh, etc.
    - show a small animation on the player view when an emote is sent
    - limit the number of emotes per game to avoid spam


## Game flow improvements
- Rejoining
    - allow players to rejoin if they get disconnected. We need to keep track of players by their unique ids and allow them to rejoin the game in progress, and restore their state (score, avatar, etc.)
    - Show the player a message if they get disconnected. Show a reconnect button that tries to reconnect them to the game. Reconnection: Allow a connection only if the cookie or deviceId matches a player already in the list (handling disconnects).
    - Explicit End: Host clicks "End Game" -> Delete key from Redis immediately.


## Different game layouts
- Common landing page layout for all games extracted out from host-game-layout.tsx
- Each game layout should accept a gameData and roomState prop to deal with common room related state as well as specific game data.


## User-id

Logic: Create a user-id concept, for every user that comes to our system. Store this in local storage and send this user id with certain messages to the websocket like join_game, create_room etc where it makes sense. Store this user id also in the appropriate types that already exist. The user id should be created by the server and sent back to the client if the request does not come with a user id.

On the client side, we should store this user id in local storage and send it with every request to the server.

- For avatars, we should store the avatar somewhere. Maybe local storage for now? db later.
(Remove this from `emit` function later)

- (later) store users in neondb
- (later) user accounts

## Room Code Management
- Room code Uniqueness: Ensure generated room codes are unique and not currently in use.
- Room code Sanitization: Remove ambiguous characters if you use numbers (e.g., remove 'I', '1', '0', 'O').
- Also avoid offensive words in room codes.

### Room management plan
- When the server gets a request to create_room, it should generate a unique room code and store it in redis with a TTL of 1 hour.
- If the room code already exists in redis, it should generate a new one and try again.
- Heartbeats: As long as the Host is connected via WebSocket, send a "heartbeat" every minute to reset the TTL to 1 hour. This ensures active rooms stay open, but if the Host crashes or closes the tab, the room expires automatically after an hour.

In redis, we will store the room code as the key and the room data as the value. The room data will be a JSON object with the following structure:

{
    host_id: string,
    created_at: string,
    updated_at: string,
    expires_at: string,
    game_type: string,
}

## Disconnection plan
- If the host disconnects, pause the game and show a message to the players
- If a player disconnects, show a message to the host
- Remove the logic from server.ts that deletes the room when there is nobody in the room
- Don't delete players from the room when they disconnect. Only maintain a status of the player and set that to be disconnected.


- On the UI, keep the player in the room and their profile has a dotted border to show that they are disconnected.

## Host promotion makes no sense
- It needs to be removed because there can be only one host and the players cannot be promoted to host.

## Reconnection plan
- The server should store all the room data like game state, player data, etc. in memory
- When the server gets a request to `reconnect_room:host` or `reconnect_room:player`, it should check if the room exists in memory and if the user that's trying to reconnect is in the room
- If the room exists and the user is in the room, it should return the room data to the client
- If the room does not exist or the user is not in the room, it should return a 404 error

## Game end action button
- Show a recommendation marquee at the end of the game with the list of other packs available to play.
- Add another button below this to go to "Explore Game Library".
